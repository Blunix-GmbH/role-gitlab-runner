- name: install gitlab gpg key
  apt_key:
    state: present
    url: https://packages.gitlab.com/gpg.key

- name: install packages required for https:// repositories
  apt:
    name:
      - curl
      - ca-certificates
      - debian-archive-keyring
      - apt-transport-https
    state: present

- name: template /etc/apt/sources.list.d/gitlab_gitlab-ci-multi-runner.list
  apt_repository:
    repo: 'deb https://packages.gitlab.com/runner/gitlab-ci-multi-runner/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release | lower }} main'
    state: present
    filename: gitlab_gitlab-ci-multi-runner.list
    update_cache: yes

- name: install the gitlab-runner
  apt:
    name: gitlab-ci-multi-runner
    state: present
